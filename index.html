<!DOCTYPE html>

<html>

<head>
<title>Gravity Simulator</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<script type="text/javascript">
var canvas;
var ctx;
var W;
var H;
var masses;

var G = 10;

$(function() {
	// init
	W = document.body.clientWidth;
	H = document.body.clientHeight;
	var jcan = $("#canvas");
	canvas = jcan[0];
	ctx = canvas.getContext("2d");
	jcan.attr("width", W);
	jcan.attr("height", H);
	jcan.css("width", W);
	jcan.css("height", H);

	setup();
	runID = setInterval(run, 33);
});

function setup() {
	// ctx.fillRect(10, 10, W - 20, H - 20);

	masses = [];
	for (var i = 0; i < 10; i++) {
		var mass = {
			x: Math.random() * W,
			y: Math.random() * H,
			m: 10 + Math.random() * 100,
			vx: 0,
			vy: 0
		};

		masses.push(mass);
	}
}

function run() {
	ctx.clearRect(0, 0, W, H);
	masses.forEach(function(mass, i) {
		// console.log(x);

		masses.forEach(function(other, j) {
			if (other.x != mass.x || other.y != mass.y) {
				var accel = gforce(mass, other) / mass.m;
				var direc = dir(mass, other);
				mass.vx += direc.x * accel;
				mass.vy += direc.y * accel;
			}
		});

		if (mass.x < 0 || mass.x > W) {
			mass.vx = -mass.vx;
		}
		if (mass.y < 0 || mass.y > H) {
			mass.vy = -mass.vy;
		}

		mass.x += mass.vx;
		mass.y += mass.vy;

		ctx.beginPath();
		ctx.arc(Math.floor(mass.x), Math.floor(mass.y), Math.pow(mass.m, 1.0/3), 0, 2 * Math.PI, false);
		ctx.fill();
		ctx.closePath();
	});
}

function gforce(a, b) {
	// Newton's law of universal gravitation
	return G * a.m * b.m / (100 + (a.x-b.x)*(a.x-b.x) + (a.y-b.y)*(a.y-b.y));
}

function dir(a, b) {
	// returns unit vector in direction of a -> b
	var d = Math.sqrt((a.x-b.x)*(a.x-b.x) + (a.y-b.y)*(a.y-b.y))
	return {
		x: (b.x - a.x) / d,
		y: (b.y - a.y) / d
	};
}

</script>
<style type="text/css">
body {
	position: absolute;
	margin: 0;
	top: 0px;
	left: 0px;
	width: 100%;
	height: 100%;
}
#canvas {
	position: absolute;
	left: 0px;
	top: 0px;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>
</body>
</html>
